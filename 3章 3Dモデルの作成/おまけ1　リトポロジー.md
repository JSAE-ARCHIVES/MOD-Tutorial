# リトポロジーとは？
モデル形状を維持したままポリゴン数を減らしてメッシュを再構築することをリトポロジーといいます。  
CADからエクスポートしたメッシュデータは細かく（数百万△ポリゴン）重たいデータです。Assetto Corsaでは1つのオブジェクト内に含まれる頂点の数には制限がありますが、車両全体の頂点数にはあまり制限がないようです。しかし、頂点数が多いままのモデルをそのままMOD化するとプレイ時にGPUへの負荷が非常に高くなってしまいます。
[NK16MOD](https://github.com/JSAE-ARCHIVES/FSAEJ-simulator/tree/main/NK16_ICV)は約30万頂点でプレイ時のフレームレートは160fpsですが、300万頂点のモデルだと80fps程度まで下がり、非常に負荷が高くなっていることがわかりました。（検証環境intel core i7 9700k+RTX3060）  
プレイ環境のスペックに自信がない方はCADからエクスポートしたモデルの頂点を削減する作業を行うことで快適にプレイできるようになります。
 
配布中の[NK16 MOD](https://github.com/JSAE-ARCHIVES/FSAEJ-simulator/tree/main/NK16_ICV)は配布用にプレイ環境を選ばない軽量なデータにするために、CADからインポートしたモデルを参考に、blender上で形を1から作り直しました。この作業は3DCGのテクニックが要求されることに加えて非常に時間がかかるので大変な作業になりますが、ぜひチャレンジしてみてください。本章では学生フォーミュラ車両（特にスペースフレーム）のリトポロジーに役立つテクニックを紹介していきます。

## リトポロジーのコツ  
よく見える場所（ドライバー視点のコクピット周り，フロントの足回り等）はポリゴン数を割いてよい  
見えにくい場所でとことんポリゴン数を削減する．  
穴はポリゴン数を増やす原因となるのであけない(よく見える部分は空ける)  

リトポロジー済の`collection`を作りコレクションを非表示にしておく．
オブジェクトを選択して`M`でコレクションを移動できるので，リトポロジーが終わったものから順にリトポロジー済みのコレクションに移動させていくと作業の進捗が分かりやすい．


## リトポロジー
分割したパーツをローポリゴンのモデルに置き換えていきます。

### カーブオブジェクトを使ったスペースフレームのモデリング
CADデータは細かすぎる&厚みがある分、頂点数が2倍なのでパイプをローポリモデルで置き換えることで大幅なポリゴン削減になります。  
インポートしたCADデータを参考にblenderで新しくモデリングします。  
#### カーブオブジェクト
曲がったパイプ状のパーツを作るのに便利．メッシュではないので最後にメッシュ化して使います。
`Shift+C`で3Dカーソルを原点にリセットし`Shift+A`で`カーブ>パス`を追加
![パスカーブの追加](https://user-images.githubusercontent.com/81402033/138587938-500eeb6d-e8df-4870-b396-6600c9a824b1.png)
オブジェクトデータプロパティの設定  
プレビュー解像度Uはパイプの長さ方向の解像度を決める．1~3推奨．（大きすぎるとパイプが曲がっていない部分にも分割が入って頂点数が増えてしまう．）
`ジオメトリ>ベベル>深度`でパイプ太さ，`解像度`でパイプ断面の滑らかさを決める．
解像度は2（8角形）程度でよい．（スムーズシェードにするのでカクカクは目立たなくなる）
![カーブの設定](https://user-images.githubusercontent.com/81402033/138587924-5e4f66b0-9a44-43c3-ae92-22b8e005364b.png)
モディファイアタブを開きミラーモディファイアを追加．
![ミラーモディファイアの追加](https://user-images.githubusercontent.com/81402033/138587945-1678bdc9-541f-4c2f-94c5-bbb5c5400c91.png)

`Tab`で編集モードに入りメッシュと同様に押し出し等を用いてフレームの形を作る．
同じ太さのパイプは1オブジェクトにまとめる．太さの違うパイプを追加したい場合は別のカーブオブジェクトを追加して深度を調節する．
角パイプを作りたい場合，ベベル解像度を0にすればよい．初期状態ではひし形のようになっているが、通常の回転（R）では直せない．この場合はカーブオブジェクトを捩る`Ctrl+T>45`で45°捩ると良い．
フレームの形が出来上がったらカーブオブジェクトを複製しておく（メッシュに変換した後のパイプ編集は困難なのでミスが発覚した際に戻って作業が出来るように）複製したオブジェクトを選択し，`オブジェクト>変換>メッシュ`でカーブをメッシュ化。
![カーブをメッシュに変換](https://user-images.githubusercontent.com/81402033/138587909-2725fae6-05aa-4892-a663-a0e63ed8a76e.png)

### 頂点の結合による頂点削減
アップライト等の削り出しパーツの頂点削減に有効です。
編集モードで削減したい部分の頂点（または全選択）を選択し`M（マージ）>距離で`を選ぶと指定した距離以内にある頂点を結合することができる．
左下に出てくるパネルの`結合距離`の数字を変えることで結合する頂点の距離を調整することができる．形状のニュアンスを損なわない程度に数字を大きくすることで数千もの頂点を結合，削減することができる．
但し，パイプやカウル等の薄板上の物は形状の解像度よりも板の厚さ方向の方が頂点同士の距離が短いため，板の厚さ方向に頂点が結合される．その際にぼこぼこになってしまうので板状パーツにはこの方法は向かない．  
![距離でマージによる頂点削減](https://user-images.githubusercontent.com/81402033/138587900-428dc18f-044a-448c-8528-46cff597d8d0.png)
![距離でマージによる頂点削減2](https://user-images.githubusercontent.com/81402033/138587902-0d04e311-6a5d-4147-b6ae-053f2f2d3ea9.png)

### カウル等
自分で新たにモデリングする必要がある．
1. `Shift+A`で作りたい形状に近い基本形状を選ぶ
`E`（[押し出し](https://blender-cg.net/extrude/)）、`F`([面張り](https://blender-cg.net/make-edge-face/))、`Ctrl+R`（[ループカット](https://blender-cg.net/loop-subdivide/)），`Ctrl+B`（[ベベル](https://blender-cg.net/bevel/)）、ブーリアンモディファイア　（押し出しカットのような操作ができる）等の基本的なコマンドを用いて大まかな形を作る  
1. サブディビジョンサーフェスモディファイアで形を滑らかに  
1. ソリッド化モディファイアで厚み付け  

傾いているオブジェクトをモデリングするときは，オブジェクトモードで傾きをつけて編集モードでローカル座標を用いてモデリングするとやりやすい

| Back | Next |
|:---:|:---:|
| | |



